<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lihat Kegiatan</title>
    <link rel="stylesheet" href="/dashboard_admin.css" />
  </head>

  <body>
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="profile">
        <h3>Youth Ministry Kebonjati</h3>
        <img
          src="https://cdn-icons-png.flaticon.com/512/847/847969.png"
          alt=""
        />
        <h3>Admin</h3>
        <span class="status">âœ”</span>
      </div>

      <ul class="menu">
        <li onclick="location.href='/admin/dashboard'">
          <i class="icon">ğŸ </i> Dashboard
        </li>
        <li id="data-btn"><i class="icon">ğŸ“Š</i> Data</li>
        <ul class="submenu" id="submenu-data">
          <li class="submenu-item" onclick="location.href='/admin/lihat_users'">
            Lihat Users
          </li>
          <li
            class="submenu-item"
            onclick="location.href='/admin/lihat_data_diri'"
          >
            Lihat Data Diri
          </li>
          <li class="submenu-item" onclick="location.href='/admin/lihat_role'">
            Lihat Role
          </li>
        </ul>
        <li id="absen-btn" class="active"><i class="icon">ğŸ”–</i> Absen</li>
        <ul class="submenu" id="submenu-absen" style="display: block">
          <li class="active2" onclick="location.href='/admin/lihat_kegiatan'">
            Lihat Kegiatan
          </li>
          <li
            class="submenu-item"
            onclick="location.href='/admin/lihat_absensi'"
          >
            Lihat Absensi
          </li>
        </ul>
        <li onclick="location.href='/admin/home'">
          <i class="icon">â†©</i> back to home
        </li>
        <li onclick="location.href='home.html'">
          <i class="icon">ğŸšª</i> Log Out
        </li>
      </ul>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <!-- Topbar -->
      <header class="topbar">
        <input type="text" class="search" placeholder="Search projects" />
        <div class="admin-dropdown">
          <span id="adminBtn">Admin â–¼</span>
          <ul id="dropdownMenu">
            <li>Profile</li>
            <li>Settings</li>
          </ul>
        </div>
      </header>

      <!-- Header Halaman -->
      <section class="dashboard-card">
        <div class="card-header">
          <div class="title-group">
            <div class="icon-home">ğŸ </div>
            <h2>Kegiatan</h2>
          </div>

          <button
            style="
              background: #1a73e8;
              color: white;
              border: none;
              cursor: pointer;
              font-size: 13px;
            "
            onclick="location.href='/kegiatan/create'"
          >
            Create Kegiatan Baru
          </button>
        </div>

        <!-- Table Container -->
        <div style="padding: 20px">
          <label>
            <select style="padding: 5px 10px">
              <option>10</option>
              <option>25</option>
              <option>50</option>
            </select>
            entries per page
          </label>

          <div style="float: right; margin-bottom: 10px">
            Search: <input type="text" style="padding: 5px" />
          </div>

          <!-- Tabel Users -->
          <table
            style="
              width: 100%;
              border-collapse: collapse;
              background: white;
              margin-top: 20px;
              border-radius: 10px;
              overflow: hidden;
            "
          >
            <thead style="background: #f2f5f8">
              <tr>
                <th style="padding: 10px;text-align: center;">No Kegiatan</th>
                <th style="padding: 10px;text-align: center;">Nama Kegiatan</th>
                <th style="padding: 10px;text-align: center;">Lokasi Tempat</th>
                <th style="padding: 10px;text-align: center;">Status</th>
                <th style="padding: 10px;text-align: center;">Waktu</th>
                <th style="padding: 10px;text-align: center;">Tanggal Mulai</th>
                <th style="padding: 10px;text-align: center;">Tanggal Akhir</th>
                <th style="padding: 10px;text-align: center;">Deskripsi</th>
                <th style="padding: 10px;text-align: center;">Edit</th>
                <th style="padding: 10px;text-align: center;">Delete</th>
              </tr>
            </thead>
            <tbody id="kegiatanTable">
              <tr>
                <td colspan="10">Loading...</td>
              </tr>
            </tbody>
          </table>

          <!-- Pagination -->
          <div style="margin-top: 20px; text-align: center">
            Â« â€¹
            <input
              type="text"
              value="1"
              style="width: 30px; text-align: center"
            />
            â€º Â»
          </div>
        </div>
      </section>
    </main>

    <script>
      // Dropdown Admin
      const adminBtn = document.getElementById("adminBtn");
      const dropdownMenu = document.getElementById("dropdownMenu");

      adminBtn.addEventListener("click", () => {
        dropdownMenu.style.display =
          dropdownMenu.style.display === "block" ? "none" : "block";
      });

      document.addEventListener("click", (e) => {
        if (!adminBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
          dropdownMenu.style.display = "none";
        }
      });

      // Dropdown Data
      const dataBtn = document.getElementById("data-btn");
      const submenuData = document.getElementById("submenu-data");

      dataBtn.addEventListener("click", () => {
        submenuData.style.display =
          submenuData.style.display === "block" ? "none" : "block";
      });

      // --- Dropdown Absen ---
      const absenBtn = document.getElementById("absen-btn");
      const submenuabsen = document.getElementById("submenu-absen");

      absenBtn.addEventListener("click", () => {
        submenuabsen.style.display =
          submenuabsen.style.display === "block" ? "none" : "block";
      });
    </script>

    <!-- Fetch Kegiatan Data -->
    <script>
      fetch("/api/kegiatan")
        .then((res) => res.json())
        .then((data) => {
          const table = document.getElementById("kegiatanTable");
          table.innerHTML = "";

          if (!data || data.length === 0) {
            table.innerHTML =
              "<tr><td colspan='10'>Belum ada kegiatan</td></tr>";
            return;
          }

          data.forEach((kegiatan, index) => {
            const statusText = kegiatan.status == 1 ? "Aktif" : "Nonaktif";
            const statusColor = kegiatan.status == 1 ? "green" : "red";

            table.innerHTML += `
          <tr>
            <td style="text-align: center;">${index + 1}</td>
            <td style="text-align: center;">${kegiatan.nama_kegiatan}</td>
            <td style="text-align: center;">${kegiatan.lokasi}</td>
            <td style="color:${statusColor}; font-weight:600; text-align: center;">
              ${statusText}
            </td>
            <td style="text-align: center;">${kegiatan.waktu}</td>
            <td style="text-align: center;">
              ${new Date(kegiatan.tanggal_mulai).toLocaleDateString("id-ID")}
            </td>
            <td style="text-align: center;">
              ${new Date(kegiatan.tanggal_akhir).toLocaleDateString("id-ID")}
            </td>
            <td style="text-align: center;">${kegiatan.deskripsi || "-"}</td>
            <td>
              <button 
                onclick="editKegiatan(${kegiatan.idKegiatan})"
                style="padding:5px 10px;text-align: center; cursor:pointer">
                edit
              </button>
            </td>
            <td>
              <button 
                onclick="deleteKegiatan(${kegiatan.idKegiatan})"
                style="padding:5px 10px;text-align: center; cursor:pointer; color:red">
                delete
              </button>
            </td>
          </tr>
        `;
          });
        })
        .catch((err) => {
          console.error(err);
          document.getElementById("kegiatanTable").innerHTML =
            "<tr><td colspan='10' style='text-align: center;'>Gagal memuat data</td></tr>";
        });

      function editKegiatan(id) {
        window.location.href = `/admin/edit_kegiatan/${id}`;
      }

      function deleteKegiatan(id) {
        if (confirm("Yakin ingin menghapus kegiatan ini?")) {
          fetch(`/api/kegiatan/${id}`, { method: "DELETE" })
            .then((res) => res.json())
            .then(() => location.reload())
            .catch((err) => alert("Gagal menghapus kegiatan"));
        }
      }
    </script>
  </body>
</html>
