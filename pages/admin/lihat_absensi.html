<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lihat Absensi</title>
  <link rel="stylesheet" href="/public/dashboard_admin.css">
</head>

<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="profile">
      <h3>Youth Ministry Kebonjati</h3>
      <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" alt="">
      <h3>Admin</h3>
      <span class="status">âœ”</span>
    </div>

    <ul class="menu">
      <li ><i class="icon">ğŸ </i> Dashboard</li>
      <li id="data-btn"><i class="icon">ğŸ“Š</i> Data</li>
        <ul class="submenu" id="submenu-data">
            <li class="submenu-item" href="lihat_users.html">Lihat Users</li>
            <li class="submenu-item" href="lihat_data_diri.html">Lihat Data Diri</li>
            <li class="submenu-item" href="lihat_role.html">Lihat Role</li>
        </ul>
      <li id="absen-btn" class="active"><i class="icon">ğŸ”–</i> Absen</li>
        <ul class="submenu" id="submenu-absen">
            <li class="submenu-item" >Lihat Kegiatan</li>
            <li class="active2" href="lihat_data_diri.html">Lihat Absensi</li>
        </ul>
      <li><i class="icon" href="home_admin.html">â†©</i> back to home</li>
      <li id="logout-btn"><i class="icon" href="home.html">ğŸšª</i> Log Out</li>

    </ul>
  </aside>

  <!-- Main Content -->
  <main class="main">

    <!-- Topbar -->
    <header class="topbar">
      <input type="text" class="search" placeholder="Search projects">
      <div class="admin-dropdown">
        <span id="adminBtn">Admin â–¼</span>
        <ul id="dropdownMenu">
          <li>Profile</li>
          <li>Settings</li>
        </ul>
      </div>
    </header>

    <!-- Header Halaman -->
    <section class="dashboard-card">
      <div class="card-header">
        <div class="title-group">
          <div class="icon-home">ğŸ </div>
          <h2>QR Code Kegiatan</h2>
        </div>
      </div>

      <!-- Table Container -->
      <div style="padding:20px;">
        <label>
          <select style="padding:5px 10px;">
            <option>10</option>
            <option>25</option>
            <option>50</option>
          </select>
          entries per page
        </label>

        <div style="float:right; margin-bottom:10px;">
          Search: <input type="text" style="padding:5px;">
        </div>

        <!-- Tabel Users -->
        <table 
          style="
            width:100%;
            border-collapse:collapse;
            background:white;
            margin-top:20px;
            border-radius:10px;
            overflow:hidden;">
          
          <thead style="background:#f2f5f8;">
            <tr>
              <th style="padding:10px;">ID</th>
              <th style="padding:10px;">Kegiatan</th>
              <th style="padding:10px;">URL QR Code</th>
              <th style="padding:10px;">Gambar QR Code</th>
               <th style="padding:10px;">Hasil Absensi</th>
               <th style="padding:10px;">Status</th>
               <th style="padding:10px;">.</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="padding:10px; text-align:center;">William</td>
              <td style="padding:10px; text-align:center;">william@example.com</td>
              <td style="padding:10px; text-align:center;">Admin</td>
               <td style="padding:10px; text-align:center;"><a class="btn btn-sm btn-warning" href="/user/edit/${u.username}">Edit</a></td>
               <td style="padding:10px; text-align:center;"><a class="btn btn-sm btn-danger" href="/user/delete/${u.username}">Delete</a></td>
            </tr>
          </tbody>
        </table>

        <!-- Pagination -->
        <div style="margin-top:20px; text-align:center;">
          Â« â€¹ <input type="text" value="1" style="width:30px; text-align:center;"> â€º Â»
        </div>

      </div>
    </section>

  </main>

<script>
  // Dropdown Admin
  const adminBtn = document.getElementById("adminBtn");
  const dropdownMenu = document.getElementById("dropdownMenu");

  adminBtn.addEventListener("click", () => {
    dropdownMenu.style.display =
      dropdownMenu.style.display === "block" ? "none" : "block";
  });

  document.addEventListener("click", (e) => {
    if (!adminBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
      dropdownMenu.style.display = "none";
    }
  });

  // Dropdown Data
  const dataBtn = document.getElementById("data-btn");
  const submenuData = document.getElementById("submenu-data");

  dataBtn.addEventListener("click", () => {
    submenuData.style.display =
      submenuData.style.display === "block" ? "none" : "block";
  });

  // --- Dropdown Absen ---
  const absenBtn = document.getElementById("absen-btn");
  const submenuabsen = document.getElementById("submenu-absen");

  absenBtn.addEventListener("click", () => {
    submenuabsen.style.display =
      submenuabsen.style.display === "block" ? "none" : "block";
  });

  // Ambil data dari API dan tampilkan di tabel
async function loadUsers() {
  const response = await fetch("/api/users");
  const tbody = document.querySelector("tbody");
  if (!response.ok) {
    // Try to read JSON error message
    let err;
    try { err = await response.json(); } catch (e) { err = null; }
    tbody.innerHTML = `<tr><td colspan="6" style="padding:10px;text-align:center;color:red;">Gagal mengambil data user; ${err && err.error ? err.error : 'Silakan coba lagi'}. <a href="#" onclick="loadUsers();return false;">Muat ulang</a></td></tr>`;
    console.error('apiUsers failed', err, response.status);
    return;
  }
  let users;
  try {
    users = await response.json();
  } catch (e) {
    tbody.innerHTML = `<tr><td colspan="6" style="padding:10px;text-align:center;color:red;">Gagal memproses respons server; silakan coba lagi.</td></tr>`;
    console.error('Failed to parse users response', e);
    return;
  }

  tbody.innerHTML = "";

  if (!users || users.length === 0) {
    tbody.innerHTML = `<tr><td colspan="6" style="padding:10px;text-align:center;color:#666;">Tidak ada pengguna.</td></tr>`;
    return;
  }

  users.forEach(u => {
    tbody.innerHTML += `
      <tr>
        <td style="padding:10px;text-align:center;">${u.username}</td>
        <td style="padding:10px;text-align:center;">${u.nama_lengkap}</td>
        <td style="padding:10px;text-align:center;">${u.email}</td>
        <td style="padding:10px;text-align:center;">${u.role}</td>
        <td style="padding:10px;text-align:center;"><a class="btn btn-sm btn-warning" href="/user/edit/${u.username}">Edit</a></td>
        <td style="padding:10px;text-align:center;"><a class="btn btn-sm btn-danger" href="/user/delete/${u.username}">Delete</a></td>
      </tr>
    `;
  });
}

loadUsers();
</script>

</body>
</html>
