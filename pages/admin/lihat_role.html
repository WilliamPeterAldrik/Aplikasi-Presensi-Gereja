<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lihat Role - Admin</title>
  <link rel="stylesheet" href="dashboard_admin.css">
</head>

<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="profile">
      <h3>Youth Ministry Kebonjati</h3>
      <img src="https://cdn-icons-png.flaticon.com/512/847/847969.png" alt="">
      <h3>Admin</h3>
      <span class="status">âœ”</span>
    </div>

    <ul class="menu">
      <li onclick="location.href='dashboard_admin.html'"><i class="icon">ğŸ </i> Dashboard</li>

      <li id="data-btn"><i class="icon">ğŸ“Š</i> Data</li>
      <ul class="submenu" id="submenu-data" style="display:block;">
        <li class="submenu-item" onclick="location.href='lihat_users.html'">Lihat Users</li>
        <li class="submenu-item" onclick="location.href='lihat_data_diri.html'">Lihat Data Diri</li>
        <li class="submenu-item" style="color:#0066cc;">Lihat Role</li>
      </ul>

      <li id="absen-btn"><i class="icon">ğŸ”–</i> Absen</li>
        <ul class="submenu" id="submenu-absen">
            <li class="submenu-item" onclick="location.href='lihat_kegiatan.html'">Lihat Kegiatan</li>
            <li class="submenu-item" onclick="location.href='lihat_absensi.html'">Lihat Absensi</li>
        </ul>
      <li onclick="location.href='home_admin.html'"><i class="icon">â†©</i> back to home</li>
      <li onclick="location.href='logout.html'"><i class="icon">ğŸšª</i> Log Out</li>
    </ul>
  </aside>

  <!-- Main Content -->
  <main class="main">

    <!-- Topbar -->
    <header class="topbar">
      <div class="menu-toggle">â˜°</div>
      <input type="text" class="search" placeholder="Search roles">
      <div class="admin-dropdown">
        <span id="adminBtn">Admin â–¼</span>
        <ul id="dropdownMenu">
          <li>Profile</li>
          <li>Settings</li>
        </ul>
      </div>
    </header>

    <!-- Header Halaman -->
    <section class="dashboard-card">
      <div class="card-header">
        <div class="title-group">
          <div class="icon-home">ğŸ“‚</div>
          <h2>Role</h2>
        </div>

        <button 
          style="background:#1a73e8; color:white; border:none; padding:6px 10px; border-radius:6px; cursor:pointer; font-size:12px;"
          onclick="location.href='add_role.html'">
          Tambahkan Role
        </button>
      </div>

      <!-- Table Container -->
      <div style="padding:20px;">
        <label>
          <select style="padding:5px 10px;">
            <option>10</option>
            <option>25</option>
            <option>50</option>
          </select>
          entries per page
        </label>

        <div style="float:right; margin-bottom:10px;">
          Search: <input type="text" id="roleSearch" style="padding:5px;">
        </div>

        <!-- Tabel Role -->
        <table style="width:100%; border-collapse:collapse; background:white; margin-top:20px; border-radius:10px; overflow:hidden;">
          <thead style="background:#f2f5f8;">
            <tr>
              <th style="padding:10px;">ID Role</th>
              <th style="padding:10px;">Nama Role</th>
              <th style="padding:10px;">Edit</th>
              <th style="padding:10px;">Delete</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td colspan="4" style="padding:10px;text-align:center;color:#666;">Memuat data...</td>
            </tr>
          </tbody>
        </table>

        <!-- Pagination -->
        <div style="margin-top:20px; text-align:center;">
          Â« â€¹ <input type="text" value="1" style="width:30px; text-align:center;"> â€º Â»
        </div>

      </div>
    </section>

  </main>

<script>
  // Dropdown Admin
  const adminBtn = document.getElementById("adminBtn");
  const dropdownMenu = document.getElementById("dropdownMenu");

  adminBtn.addEventListener("click", () => {
    dropdownMenu.style.display = dropdownMenu.style.display === "block" ? "none" : "block";
  });

  document.addEventListener("click", (e) => {
    if (!adminBtn.contains(e.target) && !dropdownMenu.contains(e.target)) {
      dropdownMenu.style.display = "none";
    }
  });

  // Dropdown Data
  const dataBtn = document.getElementById("data-btn");
  const submenuData = document.getElementById("submenu-data");

  dataBtn.addEventListener("click", () => {
    submenuData.style.display = submenuData.style.display === "block" ? "none" : "block";
  });

  // --- Dropdown Absen ---
  const absenBtn = document.getElementById("absen-btn");
  const submenuabsen = document.getElementById("submenu-absen");

  absenBtn.addEventListener("click", () => {
    submenuabsen.style.display =
      submenuabsen.style.display === "block" ? "none" : "block";
  });

  // Ambil data role dari API
  async function loadRoles() {
    const response = await fetch("/api/roles");
    const tbody = document.querySelector("tbody");
    if (!response.ok) {
      let err;
      try { err = await response.json(); } catch (e) { err = null; }
      tbody.innerHTML = `<tr><td colspan="4" style="padding:10px;text-align:center;color:red;">Gagal mengambil data role; ${err && err.error ? err.error : 'Silakan coba lagi'}. <a href="#" onclick="loadRoles();return false;">Muat ulang</a></td></tr>`;
      console.error('apiRoles failed', err, response.status);
      return;
    }

    let roles;
    try {
      roles = await response.json();
    } catch (e) {
      tbody.innerHTML = `<tr><td colspan="4" style="padding:10px;text-align:center;color:red;">Gagal memproses respons server.</td></tr>`;
      console.error('Failed to parse roles response', e);
      return;
    }

    tbody.innerHTML = "";
    if (!roles || roles.length === 0) {
      tbody.innerHTML = `<tr><td colspan="4" style="padding:10px;text-align:center;color:#666;">Tidak ada role.</td></tr>`;
      return;
    }

    roles.forEach(r => {
      tbody.innerHTML += `
        <tr>
          <td style="padding:10px;text-align:center;">${r.idRole}</td>
          <td style="padding:10px;text-align:center;">${r.namaRole}</td>
          <td style="padding:10px;text-align:center;"><a class="btn btn-sm btn-warning" href="/role/edit/${r.idRole}">Edit</a></td>
          <td style="padding:10px;text-align:center;"><a class="btn btn-sm btn-danger" href="/role/delete/${r.idRole}">Delete</a></td>
        </tr>
      `;
    });
  }

  loadRoles();

  // Filter search sederhana
  const searchInput = document.getElementById("roleSearch");
  searchInput.addEventListener("input", () => {
    const filter = searchInput.value.toLowerCase();
    document.querySelectorAll("tbody tr").forEach(row => {
      const text = row.textContent.toLowerCase();
      row.style.display = text.includes(filter) ? "" : "none";
    });
  });
</script>

</body>
</html>
